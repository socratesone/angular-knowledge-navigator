<div class="article-header" 
     [class.loading]="isLoading"
     data-testid="article-header">
  
  <!-- Loading State -->
  <div *ngIf="isLoading" class="header-loading">
    <div class="loading-skeleton title-skeleton"></div>
    <div class="loading-skeleton badges-skeleton"></div>
  </div>

  <!-- Header Content -->
  <div *ngIf="!isLoading && metadata" class="header-content">
    
    <!-- Article Title -->
    <div class="article-title-section">
      <h1 class="article-title" [attr.aria-label]="articleTitle()">
        {{ articleTitle() }}
      </h1>
      
      <!-- Article Metadata Tags -->
      <div class="article-tags" *ngIf="metadata.tags && metadata.tags.length > 0">
        <mat-chip-set aria-label="Article tags">
          <mat-chip *ngFor="let tag of metadata.tags" 
                   [selected]="false">
            {{ tag }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <!-- Header Badges and Info -->
    <div class="header-badges">
      
      <!-- Skill Level Badge -->
      <div *ngIf="showLevel && levelBadgeConfig()" 
           class="level-badge-container">
        <mat-chip [color]="levelBadgeConfig()!.color"
                 [selected]="true"
                 [class]="levelBadgeConfig()!.cssClass"
                 [matTooltip]="levelBadgeConfig()!.description"
                 [attr.aria-label]="getLevelBadgeAriaLabel()">
          <mat-icon [matChipAvatar]="true">{{ levelBadgeConfig()!.icon }}</mat-icon>
          {{ levelBadgeConfig()!.label }}
        </mat-chip>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress" 
             [attr.aria-hidden]="true">
          <div class="progress-bar" 
               [style.width.%]="levelProgress()">
          </div>
        </div>
      </div>

      <!-- Reading Time Badge -->
      <div *ngIf="showReadingTime && readingTimeDisplay()" 
           class="reading-time-badge">
        <mat-chip [selected]="false"
                 [matTooltip]="'Estimated reading time based on content complexity'"
                 [attr.aria-label]="getReadingTimeAriaLabel()">
          <mat-icon [matChipAvatar]="true">schedule</mat-icon>
          {{ readingTimeDisplay() }}
        </mat-chip>
      </div>

      <!-- Code Examples Indicator -->
      <div *ngIf="codeBlockCount() > 0" 
           class="code-examples-badge">
        <mat-chip [selected]="false"
                 [matTooltip]="codeBlockCount() + ' code examples included'"
                 [attr.aria-label]="codeBlockCount() + ' code examples in this article'">
          <mat-icon [matChipAvatar]="true">code</mat-icon>
          {{ codeBlockCount() }} {{ codeBlockCount() === 1 ? 'example' : 'examples' }}
        </mat-chip>
      </div>

      <!-- Interactive Examples Indicator -->
      <div *ngIf="hasCodeExamples()" 
           class="interactive-badge">
        <mat-chip [selected]="false"
                 color="accent"
                 matTooltip="Contains interactive code examples"
                 aria-label="This article includes interactive code examples">
          <mat-icon [matChipAvatar]="true">play_circle</mat-icon>
          Interactive
        </mat-chip>
      </div>
    </div>

    <!-- Table of Contents Dropdown -->
    <div *ngIf="showTOC && hasTOC()" 
         class="toc-dropdown-container">
      
      <!-- TOC Toggle Button -->
      <button mat-button
              class="toc-toggle-button"
              [class.expanded]="isTOCExpanded()"
              (click)="toggleTOC()"
              [attr.aria-expanded]="isTOCExpanded()"
              [attr.aria-label]="getTOCButtonAriaLabel()"
              data-testid="toc-toggle">
        <mat-icon>list</mat-icon>
        <span>Table of Contents</span>
        <mat-icon class="expand-icon" 
                 [class.rotated]="isTOCExpanded()">
          expand_more
        </mat-icon>
        <span class="section-count">({{ tocSections().length }})</span>
      </button>

      <!-- TOC Dropdown Menu -->
      <div class="toc-dropdown" 
           [class.expanded]="isTOCExpanded()"
           [attr.aria-hidden]="!isTOCExpanded()"
           aria-label="Table of contents navigation">
        
        <div *ngIf="isTOCExpanded()" class="toc-content">
          <div class="toc-header">
            <span class="toc-title">Jump to section</span>
          </div>
          
          <nav class="toc-nav">
            <ul class="toc-list">
              <li *ngFor="let section of tocSections(); trackBy: trackTOCSection"
                  class="toc-item"
                  [class]="getTOCIndentClass(section.level)"
                  [class.active]="isSectionActive(section.id)">
                
                <button [class]="getSectionCSSClass(section.id)"
                       [class.hovered]="isSectionHovered(section.id)"
                       [class.current-section]="isSectionActive(section.id)"
                       (click)="onTOCSectionClick(section)"
                       (mouseenter)="onSectionHover(section.id)"
                       (mouseleave)="onSectionHover(null)"
                       [attr.aria-label]="'Navigate to ' + section.title"
                       [attr.title]="section.title"
                       [attr.aria-current]="isSectionActive(section.id) ? 'location' : null">
                  
                  <mat-icon class="toc-icon" 
                           [attr.aria-hidden]="true">
                    {{ getTOCSectionIcon(section.level) }}
                  </mat-icon>
                  
                  <span class="toc-text">
                    {{ formatSectionTitle(section.title) }}
                  </span>
                  
                  <span class="toc-level-indicator" 
                       [attr.aria-hidden]="true">
                    H{{ section.level }}
                  </span>
                </button>

                <!-- Nested sections -->
                <ul *ngIf="section.children && section.children.length > 0" 
                    class="toc-nested">
                  <li *ngFor="let child of section.children; trackBy: trackTOCSection"
                      class="toc-item nested"
                      [class]="getTOCIndentClass(child.level)"
                      [class.active]="isSectionActive(child.id)">
                    
                    <button [class]="getSectionCSSClass(child.id) + ' nested'"
                           [class.hovered]="isSectionHovered(child.id)"
                           [class.current-section]="isSectionActive(child.id)"
                           (click)="onTOCSectionClick(child)"
                           (mouseenter)="onSectionHover(child.id)"
                           (mouseleave)="onSectionHover(null)"
                           [attr.aria-label]="'Navigate to ' + child.title"
                           [attr.title]="child.title"
                           [attr.aria-current]="isSectionActive(child.id) ? 'location' : null">
                      
                      <mat-icon class="toc-icon nested" 
                               [attr.aria-hidden]="true">
                        {{ getTOCSectionIcon(child.level) }}
                      </mat-icon>
                      
                      <span class="toc-text">
                        {{ formatSectionTitle(child.title, 35) }}
                      </span>
                      
                      <span class="toc-level-indicator" 
                           [attr.aria-hidden]="true">
                        H{{ child.level }}
                      </span>
                    </button>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>

          <!-- TOC Footer -->
          <div class="toc-footer">
            <button mat-button 
                   class="close-toc-button"
                   (click)="toggleTOC()"
                   aria-label="Close table of contents">
              <mat-icon>close</mat-icon>
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !metadata" class="header-empty">
    <div class="empty-title">No Article Selected</div>
    <div class="empty-subtitle">Choose an article from the navigation to see its header information</div>
  </div>
</div>